{% extends "./layout.html" %}

{% block content_title %}
Managers
{% endblock%}

{% block inject_to_head %}
<link rel="stylesheet" href="https://cdn.datatables.net/1.10.16/css/dataTables.bootstrap.min.css">
{% endblock %}

{% block content %}



<div class="row">
    <div class="col-lg-12">
        <div class="panel panel-default">
            <div class="panel-heading">
                Managers List
            </div>
            <!-- /.panel-heading -->
            <div class="panel-body">
                <div class="row">
                    <div class="col-lg-8">
                        <div class="form-group">
                            <select class="form-control" id="chaleixing" name="usertype"  autocomplete="off" aria-placeholder="User Type">
                                <option selected></option>
                                <option value ="1">管理员</option>
                                <option value ="2">操作员</option>
                                <option value ="3">用户</option>
                            </select>
                        </div>
                    </div>
                
                    <!-- <div class="col-lg-4">
                        <div class="form-group input-group">
                            <input type="text" class="form-control" placeholder="User Name">
                            <span class="input-group-btn">
                                <button class="btn btn-default" type="button"><i class="fa fa-search"></i></button>
                            </span>
                        </div>
                    </div> -->
                
                    <div class="col-lg-4">
                        <div class="form-gorup">
                                <button type="button" class="btn btn-success" data-toggle="modal" id="tianjia" data-target="#myModal">Add</button>
                                <button type="button" class="btn btn-primary" data-toggle="modal" id="xiugai" data-target="#myModal2">Update</button>
                                <button type="button" class="btn btn-danger" data-toggle="modal" id="shanchu" data-target="#myModal3">Delete</button>
                        </div>
                    </div>
                </div>

                <hr>

                <table id="example" cellspacing="0" width="100%" class="table table-striped table-bordered table-hover" id="dataTables-example">
                    <thead>
                        <tr>
                            <!-- <th></th> -->
                            <th><div align="center">账户</div></th>
                            <th><div align="center">名称</div></th>
                            <th><div align="center">类型</div></th>
                            <th><div align="center">手机号</div></th>
                            <th><div align="center">邮箱地址</div></th>
                            <th><div align="center">创建人</div></th>
                            <th><div align="center">创建时间</div></th>
                            <th><div align="center">修改时间</div></th>
                            <th><div align="center">操作</div></th>
                        </tr>
                    </thead>
                </table>
            </div>
            <!-- /.panel-body -->
        </div>
        <!-- /.panel -->
    </div>
    <!-- /.col-lg-12 -->
</div>

<!-- 添加对话框 -->
<div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true" style="color: #F61A3E;">&times;</span></button>
                <h4 class="modal-title" id="myModalLabel">用户添加</h4>
            </div>
            <div class="modal-body">
                <form id="tianform" autocomplete="off">
                        <label>名称：</label>
                        <input type="text" class="form-control" id="name" name="name"  placeholder="请输入名称" maxlength="10"><span class="eror">用户名不能为空！用户名2—10个位！不可以是特殊字符。</span>
                        <br><label>密码：</label>
                        <input type="password" class="form-control" id="password" name="password" placeholder="请输入密码" maxlength="10"><span class="eror">密码不能为空！密码4-10位（或密码不可以有空格）！</span>
                        <br><label>确认密码：</label>
                        <input type="password" class="form-control" id="quepassword" name="quepassword" placeholder="请确认密码"maxlength="10"><span class="eror">密码不一致！</span>
                        <br><label>邮箱：</label>
                        <input type="email" class="form-control" id="email" name="email" placeholder="请输入邮箱" maxlength="30"><span class="eror">邮箱不能为空或格式不正确！例：a@aliyun.com</span>
                        <br><label>手机号：</label>
                        <input type="text" class="form-control" id="phone" name="phone" placeholder="请输入手机号" maxlength="11"><span class="eror">手机号不能为空或格式不正确！例：187********</span>
                        <br><label>类型：</label>
                        <select id="usertype" name="usertype">
                            <option value ="1">管理员</option>
                            <option value ="2">操作员</option>
                            <option value="3">用户</option>
                        </select>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-default" data-dismiss="modal">取消</button>
                        <button type="button" class="btn btn-primary" id="tjsj_post">提交</button>
                    </div>
                </form>
            </div>

        </div>
    </div>
</div>
<!--修改对话框-->
<div class="modal fade" id="myModal2" tabindex="-1" role="dialog" aria-labelledby="myModalLabel2">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true" style="color: #F61A3E;">&times;</span></button>
                <h4 class="modal-title">修改用户信息</h4>
            </div>
            <div class="modal-body">
                <form id="gaiform" autocomplete="off">
                        <label>名称：</label>
                        <input type="text" class="form-control" id="gname" name="name"  placeholder="请输入名称" maxlength="10"><span class="eror">名称不能为空！只能输入2—10个以字母开头、可带数字、“_”、“.”！</span>
                        <br><label>邮箱：</label>
                        <input type="email" class="form-control" id="gEmail1" name="email" placeholder="请输入邮箱" maxlength="20"><span class="eror">邮箱不能为空或邮箱格式不正确！例：a@aliyun.com</span>
                        <br><label>手机号：</label>
                        <input type="text" class="form-control" id="gphone" name="phone" placeholder="请输入手机号" maxlength="11"><span class="eror">手机号不能为空或格式不正确！{13，14，15，17，18}开头********</span>
                        <br><label>类型：</label>
                        <select id="gusertype">
                            <option value ="1">管理员</option>
                            <option value ="2">操作员</option>
                            <option value="3">用户</option>
                        </select>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-default" data-dismiss="modal">取消</button>
                        <button type="button" class="btn btn-primary" id="xgsj_post">提交</button>
                    </div>
                </form>
            </div>

        </div>
    </div>
</div>
<!--删除对话框-->
<div class="modal fade" id="myModal3" tabindex="-1" role="dialog" aria-labelledby="myModalLabel3">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true" style="color: #F61A3E;">&times;</span></button>
                <h4 class="modal-title" >删除用户</h4>
            </div>
            <div class="modal-body">
                <form>
                    <div class="form-group" style="text-align: center;height: 100px;">
                       <img src="/img/icon_prompt.png" style="position: absolute;right: 0;left: 0;margin: auto;"><br><p style="margin-top: 75px;">确定删除选中的用户吗？</p>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">取消</button>
                <button type="button" class="btn btn-primary" data-dismiss="modal" id="scsj_post" onclick="delTr2()">提交</button>
            </div>
        </div>
    </div>
</div>
<!--改密对话框-->
<div class="modal fade" id="myModal5" tabindex="-1" role="dialog" aria-labelledby="myModalLabel2">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true" style="color: #F61A3E;">&times;</span></button>
                <h4 class="modal-title">重置用户密码信息</h4>
            </div>
            <div class="modal-body">
                <form id="gaimima">
                    <br><label>密码：</label>
                    <input type="password" class="form-control" id="gpassword" name="password" placeholder="请输入密码" maxlength="10"><span class="eror">密码不能为空！长度必须为4—10位(以字母开头)，由数字和字母组成！</span>
                    <br><label>确认密码：</label>
                    <input type="password" class="form-control" id="gquepassword" name="gquepassword" placeholder="请确认密码"maxlength="10"><span class="eror">密码不一致！</span>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-default" data-dismiss="modal">取消</button>
                        <button type="button" class="btn btn-primary" id="gmsj_post">提交</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>
<!--//消息框-->
<div id="cjy-maskBox"></div>

{% endblock %}

{% block script %}
<script src="https://cdn.datatables.net/1.10.16/js/jquery.dataTables.min.js"></script>
<script src="https://cdn.datatables.net/1.10.16/js/dataTables.bootstrap.min.js"></script>
<script src="/js/page.js"></script>
<script class="init">
 $(document).ready(function() {
    var table = $('#example').DataTable({
        // DataTables - Features
        // Feature enable/disable https://datatables.net/reference/option/
        "processing": true,
        "serverSide": true,  
        "searching": true,
        "info": true,
        // https://datatables.net/release-datatables/examples/basic_init/dom.html
        // "dom": '<t><"row" <"col-lg-3" l><"col-lg-3" i><"col-lg-6" p>>',
        "ajax": {
            url: "/api/1/user/search",
            type: "POST",
            data: {
                token:$.cookie("token")
            }
        },
        // columns: [
        //     // { data: "ok"},
        //     { data: "_id" },
        //     { data: "name" },
        //     { data: "usertype" },
        //     { data: "phone" },
        //     { data: "email" },
        //     { data: "creator" },
        //     { data: "createdAt" },
        //     { data: "updatedAt" },
        //     // { data: "Operation"}                           
        // ],

        // Generated content for a column: https://datatables.net/examples/ajax/null_data_source.html
        columnDefs: [
            { targets:0, data: "_id" },
            { targets:1, data: "name" },
            { targets:2, data: "usertype" },
            { targets:3, data: "phone" },
            { targets:4, data: "email" },
            { targets:5, data: "creator" },
            { targets:6, data: "createdAt" },
            { targets:7, data: "updatedAt" },
            {
                targets: -1,
                data: null,
                defaultContent: "<button>Click!</button>"
            }
        ],
        // https://datatables.net/examples/basic_init/language.html
        // language: {
        //     "lengthMenu": "Display _MENU_ records per page",
        //     "zeroRecords": "Nothing found - sorry",
        //     "info": "Showing page _PAGE_ of _PAGES_",
        //     "infoEmpty": "No records available",
        //     "infoFiltered": "(filtered from _MAX_ total records)"
        // }
    });

    $('#example tbody').on( 'click', 'button', function () {

        var data = table.row( $(this).parents('tr') ).data();
        console.log(data);
        console.log(data.name);
        //alert(data);
        alert( data.name + "  " + data.email );
    } );
} );   
</script>
{% endblock %}